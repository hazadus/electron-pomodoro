# 🍅 План реализации Pomodoro Timer

## 🛠️ Настройка среды разработки

### 📦 Зависимости и инструменты

- [x] 🔧 Установить зависимости разработки (ESLint, Prettier, TypeScript, Husky, lint-staged)
- [x] 🎵 Установить производственную зависимость `play-sound`
- [x] ⚙️ Настроить ESLint конфигурацию с правилами для Electron и TypeScript
- [x] 💅 Настроить Prettier для форматирования кода
- [x] 🐶 Настроить Husky и lint-staged для pre-commit проверок
- [x] 📝 Создать VS Code настройки для автоформатирования

### 🧪 Тестовая среда

- [x] 🎭 Установить Vitest для unit тестов
- [x] 🎪 Установить Playwright для E2E тестов
- [x] 📊 Настроить coverage отчеты
- [x] 🎯 Создать базовую структуру тестов
- [x] 🤖 Настроить моки для Electron API

### 📁 Структура проекта

- [x] 📂 Создать директории согласно архитектуре (`types/`, `services/`, `windows/`, `utils/`)
- [x] 🖼️ Добавить ресурсы (иконки для разных типов таймеров, звуковой файл)
- [x] 📄 Настроить TypeScript конфигурацию с алиасами

## 🎯 Базовая архитектура

### 📝 Типы данных

- [x] ⏰ Создать типы для таймеров (`types/timer.ts`)
- [x] ⚙️ Создать типы для настроек (`types/settings.ts`)
- [x] 📈 Создать типы для статистики (`types/stats.ts`)

### 🔧 Утилиты

- [x] 📁 Реализовать `fileManager.ts` для работы с userData
- [x] 🕐 Реализовать `timeFormatter.ts` для форматирования времени
- [x] 📋 Создать `constants.ts` с константами приложения
- [x] 📝 Настроить `logger.ts` с electron-log

## 🎛️ Основные сервисы

### ⏱️ TimerService

- [x] 🏗️ Создать базовую структуру TimerService
- [x] ▶️ Реализовать методы запуска/остановки таймера
- [x] ⏳ Добавить обратный отсчет с обновлением каждую секунду
- [x] 🔔 Интегрировать события завершения таймера
- [x] 📊 Добавить логирование событий таймера

### ⚙️ SettingsService

- [x] 📄 Создать систему загрузки/сохранения settings.json
- [x] ✅ Реализовать валидацию структуры настроек
- [x] 🔄 Добавить значения по умолчанию
- [x] 💾 Интегрировать автосохранение изменений
- [x] 🧪 Покрыть тестами все методы

### 📈 StatsService

- [x] 📊 Создать систему накопления статистики
- [x] 💾 Реализовать сохранение stats.json
- [x] ➕ Добавить методы инкремента счетчиков
- [x] 🕐 Реализовать подсчет общего времени
- [x] 🗑️ **Реализовать функцию сброса статистики с подтверждением**
- [x] 📝 Добавить логирование операций сброса

### 🔔 NotificationService

- [x] 🚨 Создать систему системных уведомлений
- [x] 🎯 Реализовать разные типы сообщений для каждого таймера
- [x] 🔘 Добавить контекстные кнопки в уведомления
- [x] ⚡ Обработать клики по кнопкам уведомлений
- [x] 🧪 Создать тесты для разных сценариев

### 🎵 SoundService

- [x] 📻 Интегрировать библиотеку play-sound
- [x] 🎼 Реализовать загрузку звукового файла
- [x] 🔊 Добавить воспроизведение с учетом настроек
- [x] 🚫 Обработать ошибки недоступности аудио
- [x] 🎚️ Реализовать проверку доступности системных аудио утилит
- [x] 📝 Добавить детальное логирование звуковых операций

### 🖱️ TrayManager

- [x] 🖼️ Создать систему управления системным треем
- [x] 📋 Реализовать динамическое меню в зависимости от состояния
- [x] ⏰ Добавить отображение времени с эмоджи в заголовке трея
- [x] 🔄 Интегрировать обновление каждую секунду
- [x] 🎯 Обработать клики по элементам меню

## 🖥️ Окна приложения

### ⚙️ Окно настроек

- [x] 🎨 Создать HTML разметку settings.html
- [x] 🔧 Реализовать preload скрипт для настроек
- [x] 💾 Добавить кнопки "Сохранить" и "Сброс к умолчанию"
- [x] ✅ Реализовать чекбокс звуковых уведомлений
- [x] 🔄 Интегрировать с SettingsService
- [x] 📱 Настроить размеры и поведение окна
- [x] Интегрировать окно настроек в `main.ts`

- [x] Интегрировать `TrayManager` в `main.ts`
- [x] Интегрировать `TimerService` в `main.ts`
- [x] Интегрировать `NotificationService` и `SoundService` в `main.ts`

### 📊 Окно статистики

- [x] 📈 Создать HTML разметку stats.html
- [x] 📋 Реализовать отображение всех счетчиков
- [x] 🕐 Добавить форматирование времени (часы/минуты)
- [x] 🗑️ **Добавить кнопку "Сбросить статистику"**
- [x] ⚠️ **Реализовать диалог подтверждения сброса**
- [x] 🔄 Интегрировать автообновление после сброса
- [x] 🎨 Настроить стили и размеры окна (350x250)
- [x] Интегрировать окно статистики в `main.ts`

### ℹ️ Окно "О программе"

- [x] 📄 Обновить существующий about.html под новое приложение
- [x] 📋 Добавить информацию о Pomodoro Timer
- [x] 🔄 Интегрировать с новой архитектурой

## 🔐 Безопасность и интеграция

### 🛡️ Preload скрипты

- [x] 🔒 Создать отдельные preload скрипты для каждого окна
- [x] 🌉 Настроить безопасные IPC каналы
- [x] ✅ Добавить валидацию всех IPC сообщений
- [x] 🧪 Протестировать contextIsolation

### 📡 IPC коммуникация

- [x] 📤 Настроить каналы для настроек (сохранение/загрузка)
- [x] 📊 Настроить каналы для статистики (получение/сброс)
- [x] ⏰ Настроить каналы для управления таймером
- [x] 🔔 Настроить каналы для уведомлений

### 🛡️ Защита от случайного закрытия

- [x] ⚠️ Реализовать предупреждение при закрытии с активным таймером
- [x] 🔘 Добавить диалог "Остановить таймер и выйти" / "Отмена"
- [x] 🎯 Интегрировать проверку состояния таймера

## Баги

- [x] При изменении длительности таймера в настройках, в меню значение не меняется. При этом, новый таймер запускается с корректным значением из настроек
- [x] Статистика не сохраняется
- [x] Сделать подходящие размеры окон, чтобы не было полос прокрутки
- [x] Уведомление по окончании таймера не отображается (MacOS)

## Улучшения

- [x] При работающем таймере скрывать иконку в трее (так как есть эмоджи и текст)
- [ ] В уведомлении об окончании таймера (на MacOS) слева значок Электрон, справа – нащ значок. Разместить наш значок вместо значка Электрона

## 🧪 Тестирование

### 🔬 Unit тесты

- [x] ⏰ Тесты TimerService (запуск, остановка, завершение)
- [x] ⚙️ Тесты SettingsService (загрузка, сохранение, валидация)
- [x] 📈 **Тесты StatsService (накопление, сброс, сохранение)**
- [x] 🔔 Тесты NotificationService (отправка, обработка кликов)
- [x] 🎵 **Тесты SoundService (воспроизведение, обработка ошибок)**
- [x] 🔧 Тесты утилит (fileManager, timeFormatter)

### 🎭 Integration тесты

- [ ] 🔄 Тестирование жизненного цикла таймеров
- [ ] 💾 Тестирование сохранения/загрузки данных
- [ ] 📡 Тестирование IPC коммуникации
- [ ] 🖱️ Тестирование обновления системного трея

### 🎪 E2E тесты

- [ ] 👤 Пользовательские сценарии работы с таймером
- [ ] 🖱️ Взаимодействие с системным треем
- [ ] 🔔 Тестирование системных уведомлений
- [ ] ⚙️ Навигация по окнам настроек и статистики
- [ ] 🗑️ **Полный сценарий сброса статистики**

## 📚 Документация

- [ ] 📝 Создать `docs/architecture.md` с подробным описанием архитектуры приложения
- [ ] 📝 Добавить подробное описание структуры директорий проекта в `README.md`

## 🎨 Финальная полировка

### 🖼️ Ресурсы и локализация

- [ ] 🎨 Создать/оптимизировать иконки для каждого типа таймера
- [ ] 🎵 Добавить качественный звуковой файл уведомлений
- [ ] 🌍 Проверить корректность русской локализации
- [ ] 📱 Тестировать на всех платформах (macOS/Windows/Linux)

### ⚡ Оптимизация

- [ ] 🚀 Оптимизировать производительность обновления трея
- [ ] 💾 Минимизировать количество операций файловой системы
- [ ] 🔋 Проверить потребление ресурсов системы
- [ ] 📊 Добавить метрики производительности в логи

### 📦 Сборка и развертывание

- [ ] 🍅 Настроить значок приложения в MacOS
- [ ] 🔨 Настроить production сборку
- [ ] 📦 Протестировать упаковку приложения
- [ ] 🚀 Создать installer для разных платформ
- [ ] 📋 Проверить работу в чистой системе
- [ ] 📦 Настроить сборку для разных ОС при помощи GitHub Action

## ✅ Контрольные точки

### 🎯 Milestone 1: Базовая функциональность

- [ ] ✅ Все сервисы реализованы и покрыты тестами
- [ ] ⏰ Таймеры работают корректно со всеми типами
- [ ] 🖱️ Системный трей отображает время и меню
- [ ] 💾 Настройки и статистика сохраняются

### 🎯 Milestone 2: Полный функционал

- [ ] 🔔 Уведомления работают с контекстными кнопками
- [ ] 🎵 Звуковые уведомления настраиваемы
- [ ] ⚙️ Все окна функционируют корректно
- [ ] 🗑️ **Сброс статистики работает с подтверждением**

### 🎯 Milestone 3: Готовое приложение

- [ ] 🧪 Все тесты проходят успешно
- [ ] 🛡️ Безопасность настроена корректно
- [ ] 📦 Приложение собирается и упаковывается
- [ ] 🌟 Готово к использованию

---

## 🔥 Критические особенности для реализации

### 🗑️ Функция сброса статистики

Особое внимание к реализации сброса статистики:

- Двойное подтверждение пользователя
- Немедленное обновление UI
- Сохранение новой даты сброса
- Логирование операции
- Обработка ошибок

### 🎵 SoundService интеграция

Важные аспекты работы со звуком:

- Кроссплатформенная совместимость
- Graceful degradation при отсутствии аудио
- Поддержка настройки включения/отключения
- Детальное логирование ошибок
- Fallback на системные звуки

### 🔐 Electron безопасность

Критические требования безопасности:

- contextIsolation для всех окон
- Отдельные preload скрипты
- Валидация всех IPC сообщений
- Ограничение доступа к файловой системе
