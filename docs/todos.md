# 🍅 План реализации Pomodoro Timer

## 🛠️ Настройка среды разработки

### 📦 Зависимости и инструменты

- [x] 🔧 Установить зависимости разработки (ESLint, Prettier, TypeScript, Husky, lint-staged)
- [x] 🎵 Установить производственную зависимость `play-sound`
- [x] ⚙️ Настроить ESLint конфигурацию с правилами для Electron и TypeScript
- [x] 💅 Настроить Prettier для форматирования кода
- [x] 🐶 Настроить Husky и lint-staged для pre-commit проверок
- [x] 📝 Создать VS Code настройки для автоформатирования

### 🧪 Тестовая среда

- [x] 🎭 Установить Vitest для unit тестов
- [x] 🎪 Установить Playwright для E2E тестов
- [x] 📊 Настроить coverage отчеты
- [x] 🎯 Создать базовую структуру тестов
- [x] 🤖 Настроить моки для Electron API

### 📁 Структура проекта

- [x] 📂 Создать директории согласно архитектуре (`types/`, `services/`, `windows/`, `utils/`)
- [x] 🖼️ Добавить ресурсы (иконки для разных типов таймеров, звуковой файл)
- [x] 📄 Настроить TypeScript конфигурацию с алиасами

## 🎯 Базовая архитектура

### 📝 Типы данных

- [x] ⏰ Создать типы для таймеров (`types/timer.ts`)
- [x] ⚙️ Создать типы для настроек (`types/settings.ts`)
- [x] 📈 Создать типы для статистики (`types/stats.ts`)

### 🔧 Утилиты

- [ ] 📁 Реализовать `fileManager.ts` для работы с userData
- [ ] 🕐 Реализовать `timeFormatter.ts` для форматирования времени
- [ ] 📋 Создать `constants.ts` с константами приложения
- [ ] 📝 Настроить `logger.ts` с electron-log

## 🎛️ Основные сервисы

### ⏱️ TimerService

- [ ] 🏗️ Создать базовую структуру TimerService
- [ ] ▶️ Реализовать методы запуска/остановки таймера
- [ ] ⏳ Добавить обратный отсчет с обновлением каждую секунду
- [ ] 🔔 Интегрировать события завершения таймера
- [ ] 📊 Добавить логирование событий таймера

### ⚙️ SettingsService

- [ ] 📄 Создать систему загрузки/сохранения settings.json
- [ ] ✅ Реализовать валидацию структуры настроек
- [ ] 🔄 Добавить значения по умолчанию
- [ ] 💾 Интегрировать автосохранение изменений
- [ ] 🧪 Покрыть тестами все методы

### 📈 StatsService

- [ ] 📊 Создать систему накопления статистики
- [ ] 💾 Реализовать сохранение stats.json
- [ ] ➕ Добавить методы инкремента счетчиков
- [ ] 🕐 Реализовать подсчет общего времени
- [ ] 🗑️ **Реализовать функцию сброса статистики с подтверждением**
- [ ] 📝 Добавить логирование операций сброса

### 🔔 NotificationService

- [ ] 🚨 Создать систему системных уведомлений
- [ ] 🎯 Реализовать разные типы сообщений для каждого таймера
- [ ] 🔘 Добавить контекстные кнопки в уведомления
- [ ] ⚡ Обработать клики по кнопкам уведомлений
- [ ] 🧪 Создать тесты для разных сценариев

### 🎵 SoundService

- [ ] 📻 Интегрировать библиотеку play-sound
- [ ] 🎼 Реализовать загрузку звукового файла
- [ ] 🔊 Добавить воспроизведение с учетом настроек
- [ ] 🚫 Обработать ошибки недоступности аудио
- [ ] 🎚️ Реализовать проверку доступности системных аудио утилит
- [ ] 📝 Добавить детальное логирование звуковых операций

### 🖱️ TrayManager

- [ ] 🖼️ Создать систему управления системным треем
- [ ] 📋 Реализовать динамическое меню в зависимости от состояния
- [ ] ⏰ Добавить отображение времени с эмоджи в заголовке трея
- [ ] 🔄 Интегрировать обновление каждую секунду
- [ ] 🎯 Обработать клики по элементам меню

## 🖥️ Окна приложения

### ⚙️ Окно настроек

- [ ] 🎨 Создать HTML разметку settings.html
- [ ] 🔧 Реализовать preload скрипт для настроек
- [ ] 💾 Добавить кнопки "Сохранить" и "Сброс к умолчанию"
- [ ] ✅ Реализовать чекбокс звуковых уведомлений
- [ ] 🔄 Интегрировать с SettingsService
- [ ] 📱 Настроить размеры и поведение окна

### 📊 Окно статистики

- [ ] 📈 Создать HTML разметку stats.html
- [ ] 📋 Реализовать отображение всех счетчиков
- [ ] 🕐 Добавить форматирование времени (часы/минуты)
- [ ] 🗑️ **Добавить кнопку "Сбросить статистику"**
- [ ] ⚠️ **Реализовать диалог подтверждения сброса**
- [ ] 🔄 Интегрировать автообновление после сброса
- [ ] 🎨 Настроить стили и размеры окна (350x250)

### ℹ️ Окно "О программе"

- [ ] 📄 Обновить существующий about.html под новое приложение
- [ ] 📋 Добавить информацию о Pomodoro Timer
- [ ] 🔄 Интегрировать с новой архитектурой

## 🔐 Безопасность и интеграция

### 🛡️ Preload скрипты

- [ ] 🔒 Создать отдельные preload скрипты для каждого окна
- [ ] 🌉 Настроить безопасные IPC каналы
- [ ] ✅ Добавить валидацию всех IPC сообщений
- [ ] 🧪 Протестировать contextIsolation

### 📡 IPC коммуникация

- [ ] 📤 Настроить каналы для настроек (сохранение/загрузка)
- [ ] 📊 Настроить каналы для статистики (получение/сброс)
- [ ] ⏰ Настроить каналы для управления таймером
- [ ] 🔔 Настроить каналы для уведомлений

### 🛡️ Защита от случайного закрытия

- [ ] ⚠️ Реализовать предупреждение при закрытии с активным таймером
- [ ] 🔘 Добавить диалог "Остановить таймер и выйти" / "Отмена"
- [ ] 🎯 Интегрировать проверку состояния таймера

## 🧪 Тестирование

### 🔬 Unit тесты

- [ ] ⏰ Тесты TimerService (запуск, остановка, завершение)
- [ ] ⚙️ Тесты SettingsService (загрузка, сохранение, валидация)
- [ ] 📈 **Тесты StatsService (накопление, сброс, сохранение)**
- [ ] 🔔 Тесты NotificationService (отправка, обработка кликов)
- [ ] 🎵 **Тесты SoundService (воспроизведение, обработка ошибок)**
- [ ] 🔧 Тесты утилит (fileManager, timeFormatter)

### 🎭 Integration тесты

- [ ] 🔄 Тестирование жизненного цикла таймеров
- [ ] 💾 Тестирование сохранения/загрузки данных
- [ ] 📡 Тестирование IPC коммуникации
- [ ] 🖱️ Тестирование обновления системного трея

### 🎪 E2E тесты

- [ ] 👤 Пользовательские сценарии работы с таймером
- [ ] 🖱️ Взаимодействие с системным треем
- [ ] 🔔 Тестирование системных уведомлений
- [ ] ⚙️ Навигация по окнам настроек и статистики
- [ ] 🗑️ **Полный сценарий сброса статистики**

## 🎨 Финальная полировка

### 🖼️ Ресурсы и локализация

- [ ] 🎨 Создать/оптимизировать иконки для каждого типа таймера
- [ ] 🎵 Добавить качественный звуковой файл уведомлений
- [ ] 🌍 Проверить корректность русской локализации
- [ ] 📱 Тестировать на всех платформах (macOS/Windows/Linux)

### ⚡ Оптимизация

- [ ] 🚀 Оптимизировать производительность обновления трея
- [ ] 💾 Минимизировать количество операций файловой системы
- [ ] 🔋 Проверить потребление ресурсов системы
- [ ] 📊 Добавить метрики производительности в логи

### 📦 Сборка и развертывание

- [ ] 🔨 Настроить production сборку
- [ ] 📦 Протестировать упаковку приложения
- [ ] 🚀 Создать installer для разных платформ
- [ ] 📋 Проверить работу в чистой системе

## ✅ Контрольные точки

### 🎯 Milestone 1: Базовая функциональность

- [ ] ✅ Все сервисы реализованы и покрыты тестами
- [ ] ⏰ Таймеры работают корректно со всеми типами
- [ ] 🖱️ Системный трей отображает время и меню
- [ ] 💾 Настройки и статистика сохраняются

### 🎯 Milestone 2: Полный функционал

- [ ] 🔔 Уведомления работают с контекстными кнопками
- [ ] 🎵 Звуковые уведомления настраиваемы
- [ ] ⚙️ Все окна функционируют корректно
- [ ] 🗑️ **Сброс статистики работает с подтверждением**

### 🎯 Milestone 3: Готовое приложение

- [ ] 🧪 Все тесты проходят успешно
- [ ] 🛡️ Безопасность настроена корректно
- [ ] 📦 Приложение собирается и упаковывается
- [ ] 🌟 Готово к использованию

---

## 🔥 Критические особенности для реализации

### 🗑️ Функция сброса статистики

Особое внимание к реализации сброса статистики:

- Двойное подтверждение пользователя
- Немедленное обновление UI
- Сохранение новой даты сброса
- Логирование операции
- Обработка ошибок

### 🎵 SoundService интеграция

Важные аспекты работы со звуком:

- Кроссплатформенная совместимость
- Graceful degradation при отсутствии аудио
- Поддержка настройки включения/отключения
- Детальное логирование ошибок
- Fallback на системные звуки

### 🔐 Electron безопасность

Критические требования безопасности:

- contextIsolation для всех окон
- Отдельные preload скрипты
- Валидация всех IPC сообщений
- Ограничение доступа к файловой системе
